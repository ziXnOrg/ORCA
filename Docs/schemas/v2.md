# WAL v2 Schema (Stub)

Status: Draft (RED phase)

Scope
- Defines canonical JSONL event record structure for WAL v2 used by ORCA runtime.
- Stable field ordering is required for deterministic replay and golden tests.

Record fields (ordered)
1) id: u64 — monotonic event id
2) ts_ms: u64 — timestamp (ms since epoch; to be supplied by VirtualClock in later tasks)
3) version: integer — WAL version (2)
4) event_type: string — canonical discriminant (e.g., start_run, task_enqueued, usage_update)
5) run_id: string — correlates events to a run
6) trace_id: string — tracing correlation id
7) payload: object — event-specific payload (typed per variant)
8) metadata: object — auxiliary metadata (redaction flags, writer, etc.)

Notes
- Use Serde struct field order (avoid maps) to guarantee deterministic field ordering.
- No secrets persisted. Redaction hooks applied upstream of WAL append.
- Single-writer invariant per WAL stream. fsync policy documented elsewhere.

Variants (initial)
- start_run { workflow_id }
- task_enqueued { envelope_id, agent }
- usage_update { tokens, cost_micros }

Golden fixture reference
- crates/event-log/tests/golden/wal_v2_sample.jsonl

TODO (in GREEN phase)
- Finalize variants and metadata fields
- Backward-compat readers and version gate (wal_v2 flag)
- Property tests and additional golden cases

